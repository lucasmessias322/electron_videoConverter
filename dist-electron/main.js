"use strict";var Ge=Object.create;var we=Object.defineProperty;var Xe=Object.getOwnPropertyDescriptor;var Qe=Object.getOwnPropertyNames;var Ye=Object.getPrototypeOf,Je=Object.prototype.hasOwnProperty;var Ze=(r,e,t,c)=>{if(e&&typeof e=="object"||typeof e=="function")for(let h of Qe(e))!Je.call(r,h)&&h!==t&&we(r,h,{get:()=>e[h],enumerable:!(c=Xe(e,h))||c.enumerable});return r};var Ke=(r,e,t)=>(t=r!=null?Ge(Ye(r)):{},Ze(e||!r||!r.__esModule?we(t,"default",{value:r,enumerable:!0}):t,r));Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const q=require("electron"),et=require("node:module"),tt=require("node:url"),N=require("node:path"),B=require("os"),j=require("path"),nt=require("util"),rt=require("events"),le=require("child_process"),G=require("fs"),it=require("stream"),ut=require("node:fs");var M=typeof document<"u"?document.currentScript:null,st=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function at(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Le={exports:{}},Q,ye;function ot(){if(ye)return Q;ye=1,Q=c,c.sync=h;var r=G;function e(u,v){var a=v.pathExt!==void 0?v.pathExt:process.env.PATHEXT;if(!a||(a=a.split(";"),a.indexOf("")!==-1))return!0;for(var p=0;p<a.length;p++){var x=a[p].toLowerCase();if(x&&u.substr(-x.length).toLowerCase()===x)return!0}return!1}function t(u,v,a){return!u.isSymbolicLink()&&!u.isFile()?!1:e(v,a)}function c(u,v,a){r.stat(u,function(p,x){a(p,p?!1:t(x,u,v))})}function h(u,v){return t(r.statSync(u),u,v)}return Q}var Y,_e;function ft(){if(_e)return Y;_e=1,Y=e,e.sync=t;var r=G;function e(u,v,a){r.stat(u,function(p,x){a(p,p?!1:c(x,v))})}function t(u,v){return c(r.statSync(u),v)}function c(u,v){return u.isFile()&&h(u,v)}function h(u,v){var a=u.mode,p=u.uid,x=u.gid,E=v.uid!==void 0?v.uid:process.getuid&&process.getuid(),O=v.gid!==void 0?v.gid:process.getgid&&process.getgid(),m=parseInt("100",8),I=parseInt("010",8),F=parseInt("001",8),A=m|I,g=a&F||a&I&&x===O||a&m&&p===E||a&A&&E===0;return g}return Y}var U;process.platform==="win32"||st.TESTING_WINDOWS?U=ot():U=ft();var ct=pe;pe.sync=lt;function pe(r,e,t){if(typeof e=="function"&&(t=e,e={}),!t){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(c,h){pe(r,e||{},function(u,v){u?h(u):c(v)})})}U(r,e||{},function(c,h){c&&(c.code==="EACCES"||e&&e.ignoreErrors)&&(c=null,h=!1),t(c,h)})}function lt(r,e){try{return U.sync(r,e||{})}catch(t){if(e&&e.ignoreErrors||t.code==="EACCES")return!1;throw t}}var pt=je;je.sync=dt;var fe=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",$e=j,ht=fe?";":":",De=ct;function Me(r){var e=new Error("not found: "+r);return e.code="ENOENT",e}function Ve(r,e){var t=e.colon||ht,c=e.path||process.env.PATH||"",h=[""];c=c.split(t);var u="";return fe&&(c.unshift(process.cwd()),u=e.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM",h=u.split(t),r.indexOf(".")!==-1&&h[0]!==""&&h.unshift("")),(r.match(/\//)||fe&&r.match(/\\/))&&(c=[""]),{env:c,ext:h,extExe:u}}function je(r,e,t){typeof e=="function"&&(t=e,e={});var c=Ve(r,e),h=c.env,u=c.ext,v=c.extExe,a=[];(function p(x,E){if(x===E)return e.all&&a.length?t(null,a):t(Me(r));var O=h[x];O.charAt(0)==='"'&&O.slice(-1)==='"'&&(O=O.slice(1,-1));var m=$e.join(O,r);!O&&/^\.[\\\/]/.test(r)&&(m=r.slice(0,2)+m),function I(F,A){if(F===A)return p(x+1,E);var g=u[F];De(m+g,{pathExt:v},function(S,P){if(!S&&P)if(e.all)a.push(m+g);else return t(null,m+g);return I(F+1,A)})}(0,u.length)})(0,h.length)}function dt(r,e){e=e||{};for(var t=Ve(r,e),c=t.env,h=t.ext,u=t.extExe,v=[],a=0,p=c.length;a<p;a++){var x=c[a];x.charAt(0)==='"'&&x.slice(-1)==='"'&&(x=x.slice(1,-1));var E=$e.join(x,r);!x&&/^\.[\\\/]/.test(r)&&(E=r.slice(0,2)+E);for(var O=0,m=h.length;O<m;O++){var I=E+h[O],F;try{if(F=De.sync(I,{pathExt:u}),F)if(e.all)v.push(I);else return I}catch{}}}if(e.all&&v.length)return v;if(e.nothrow)return null;throw Me(r)}le.exec;var vt=B.platform().match(/win(32|64)/),mt=pt,Ee=/\r\n|\r|\n/g,V=/^\[?(.*?)\]?$/,Fe=/[,]/,H={};function gt(r){var e={};r=r.replace(/=\s+/g,"=").trim();for(var t=r.split(" "),c=0;c<t.length;c++){var h=t[c].split("=",2),u=h[0],v=h[1];if(typeof v>"u")return null;e[u]=v}return e}var xe=Le.exports={isWindows:vt,streamRegexp:V,copy:function(r,e){Object.keys(r).forEach(function(t){e[t]=r[t]})},args:function(){var r=[],e=function(){arguments.length===1&&Array.isArray(arguments[0])?r=r.concat(arguments[0]):r=r.concat([].slice.call(arguments))};return e.clear=function(){r=[]},e.get=function(){return r},e.find=function(t,c){var h=r.indexOf(t);if(h!==-1)return r.slice(h+1,h+1+(c||0))},e.remove=function(t,c){var h=r.indexOf(t);h!==-1&&r.splice(h,(c||0)+1)},e.clone=function(){var t=xe.args();return t(r),t},e},makeFilterStrings:function(r){return r.map(function(e){if(typeof e=="string")return e;var t="";return Array.isArray(e.inputs)?t+=e.inputs.map(function(c){return c.replace(V,"[$1]")}).join(""):typeof e.inputs=="string"&&(t+=e.inputs.replace(V,"[$1]")),t+=e.filter,e.options&&(typeof e.options=="string"||typeof e.options=="number"?t+="="+e.options:Array.isArray(e.options)?t+="="+e.options.map(function(c){return typeof c=="string"&&c.match(Fe)?"'"+c+"'":c}).join(":"):Object.keys(e.options).length&&(t+="="+Object.keys(e.options).map(function(c){var h=e.options[c];return typeof h=="string"&&h.match(Fe)&&(h="'"+h+"'"),c+"="+h}).join(":"))),Array.isArray(e.outputs)?t+=e.outputs.map(function(c){return c.replace(V,"[$1]")}).join(""):typeof e.outputs=="string"&&(t+=e.outputs.replace(V,"[$1]")),t})},which:function(r,e){if(r in H)return e(null,H[r]);mt(r,function(t,c){if(t)return e(null,H[r]="");e(null,H[r]=c)})},timemarkToSeconds:function(r){if(typeof r=="number")return r;if(r.indexOf(":")===-1&&r.indexOf(".")>=0)return Number(r);var e=r.split(":"),t=Number(e.pop());return e.length&&(t+=Number(e.pop())*60),e.length&&(t+=Number(e.pop())*3600),t},extractCodecData:function(r,e,t){var c=/Input #[0-9]+, ([^ ]+),/,h=/Duration\: ([^,]+)/,u=/Audio\: (.*)/,v=/Video\: (.*)/;"inputStack"in t||(t.inputStack=[],t.inputIndex=-1,t.inInput=!1);var a=t.inputStack,p=t.inputIndex,x=t.inInput,E,O,m,I;if(E=e.match(c))x=t.inInput=!0,p=t.inputIndex=t.inputIndex+1,a[p]={format:E[1],audio:"",video:"",duration:""};else if(x&&(O=e.match(h)))a[p].duration=O[1];else if(x&&(m=e.match(u)))m=m[1].split(", "),a[p].audio=m[0],a[p].audio_details=m;else if(x&&(I=e.match(v)))I=I[1].split(", "),a[p].video=I[0],a[p].video_details=I;else if(/Output #\d+/.test(e))x=t.inInput=!1;else if(/Stream mapping:|Press (\[q\]|ctrl-c) to stop/.test(e))return r.emit.apply(r,["codecData"].concat(a)),!0;return!1},extractProgress:function(r,e){var t=gt(e);if(t){var c={frames:parseInt(t.frame,10),currentFps:parseInt(t.fps,10),currentKbps:t.bitrate?parseFloat(t.bitrate.replace("kbits/s","")):0,targetSize:parseInt(t.size||t.Lsize,10),timemark:t.time};if(r._ffprobeData&&r._ffprobeData.format&&r._ffprobeData.format.duration){var h=Number(r._ffprobeData.format.duration);isNaN(h)||(c.percent=xe.timemarkToSeconds(c.timemark)/h*100)}r.emit("progress",c)}},extractError:function(r){return r.split(Ee).reduce(function(e,t){return t.charAt(0)===" "||t.charAt(0)==="["?[]:(e.push(t),e)},[]).join(`
`)},linesRing:function(r){var e=[],t=[],c=null,h=!1,u=r-1;function v(a){e.forEach(function(p){p(a)})}return{callback:function(a){t.forEach(function(p){a(p)}),e.push(a)},append:function(a){if(!h&&(a instanceof Buffer&&(a=""+a),!(!a||a.length===0))){var p=a.split(Ee);p.length===1?c!==null?c=c+p.shift():c=p.shift():(c!==null&&(c=c+p.shift(),v(c),t.push(c)),c=p.pop(),p.forEach(function(x){v(x),t.push(x)}),u>-1&&t.length>u&&t.splice(0,t.length-u))}},get:function(){return c!==null?t.concat([c]).join(`
`):t.join(`
`)},close:function(){h||(c!==null&&(v(c),t.push(c),u>-1&&t.length>u&&t.shift(),c=null),h=!0)}}}},L=Le.exports,J,Ae;function wt(){if(Ae)return J;Ae=1;var r=L;return J=function(e){e.mergeAdd=e.addInput=e.input=function(t){var c=!1,h=!1;if(typeof t!="string"){if(!("readable"in t)||!t.readable)throw new Error("Invalid input");var u=this._inputs.some(function(a){return a.isStream});if(u)throw new Error("Only one input stream is supported");h=!0,t.pause()}else{var v=t.match(/^([a-z]{2,}):/i);c=!v||v[0]==="file"}return this._inputs.push(this._currentInput={source:t,isFile:c,isStream:h,options:r.args()}),this},e.withInputFormat=e.inputFormat=e.fromFormat=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-f",t),this},e.withInputFps=e.withInputFPS=e.withFpsInput=e.withFPSInput=e.inputFPS=e.inputFps=e.fpsInput=e.FPSInput=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-r",t),this},e.nativeFramerate=e.withNativeFramerate=e.native=function(){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-re"),this},e.setStartTime=e.seekInput=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-ss",t),this},e.loop=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-loop","1"),typeof t<"u"&&this.duration(t),this}},J}var Z,Oe;function yt(){if(Oe)return Z;Oe=1;var r=L;return Z=function(e){e.withNoAudio=e.noAudio=function(){return this._currentOutput.audio.clear(),this._currentOutput.audioFilters.clear(),this._currentOutput.audio("-an"),this},e.withAudioCodec=e.audioCodec=function(t){return this._currentOutput.audio("-acodec",t),this},e.withAudioBitrate=e.audioBitrate=function(t){return this._currentOutput.audio("-b:a",(""+t).replace(/k?$/,"k")),this},e.withAudioChannels=e.audioChannels=function(t){return this._currentOutput.audio("-ac",t),this},e.withAudioFrequency=e.audioFrequency=function(t){return this._currentOutput.audio("-ar",t),this},e.withAudioQuality=e.audioQuality=function(t){return this._currentOutput.audio("-aq",t),this},e.withAudioFilter=e.withAudioFilters=e.audioFilter=e.audioFilters=function(t){return arguments.length>1&&(t=[].slice.call(arguments)),Array.isArray(t)||(t=[t]),this._currentOutput.audioFilters(r.makeFilterStrings(t)),this}},Z}var K,Pe;function _t(){if(Pe)return K;Pe=1;var r=L;return K=function(e){e.withNoVideo=e.noVideo=function(){return this._currentOutput.video.clear(),this._currentOutput.videoFilters.clear(),this._currentOutput.video("-vn"),this},e.withVideoCodec=e.videoCodec=function(t){return this._currentOutput.video("-vcodec",t),this},e.withVideoBitrate=e.videoBitrate=function(t,c){return t=(""+t).replace(/k?$/,"k"),this._currentOutput.video("-b:v",t),c&&this._currentOutput.video("-maxrate",t,"-minrate",t,"-bufsize","3M"),this},e.withVideoFilter=e.withVideoFilters=e.videoFilter=e.videoFilters=function(t){return arguments.length>1&&(t=[].slice.call(arguments)),Array.isArray(t)||(t=[t]),this._currentOutput.videoFilters(r.makeFilterStrings(t)),this},e.withOutputFps=e.withOutputFPS=e.withFpsOutput=e.withFPSOutput=e.withFps=e.withFPS=e.outputFPS=e.outputFps=e.fpsOutput=e.FPSOutput=e.fps=e.FPS=function(t){return this._currentOutput.video("-r",t),this},e.takeFrames=e.withFrames=e.frames=function(t){return this._currentOutput.video("-vframes",t),this}},K}var ee,Ie;function Et(){if(Ie)return ee;Ie=1;function r(t,c,h,u){return[{filter:"scale",options:{w:"if(gt(a,"+h+"),"+t+",trunc("+c+"*a/2)*2)",h:"if(lt(a,"+h+"),"+c+",trunc("+t+"/a/2)*2)"}},{filter:"pad",options:{w:t,h:c,x:"if(gt(a,"+h+"),0,("+t+"-iw)/2)",y:"if(lt(a,"+h+"),0,("+c+"-ih)/2)",color:u}}]}function e(t,c,h){var u=t.sizeData=t.sizeData||{};if(u[c]=h,!("size"in u))return[];var v=u.size.match(/([0-9]+)x([0-9]+)/),a=u.size.match(/([0-9]+)x\?/),p=u.size.match(/\?x([0-9]+)/),x=u.size.match(/\b([0-9]{1,3})%/),E,O,m;if(x){var I=Number(x[1])/100;return[{filter:"scale",options:{w:"trunc(iw*"+I+"/2)*2",h:"trunc(ih*"+I+"/2)*2"}}]}else{if(v)return E=Math.round(Number(v[1])/2)*2,O=Math.round(Number(v[2])/2)*2,m=E/O,u.pad?r(E,O,m,u.pad):[{filter:"scale",options:{w:E,h:O}}];if(a||p)return"aspect"in u?(E=a?a[1]:Math.round(Number(p[1])*u.aspect),O=p?p[1]:Math.round(Number(a[1])/u.aspect),E=Math.round(E/2)*2,O=Math.round(O/2)*2,u.pad?r(E,O,u.aspect,u.pad):[{filter:"scale",options:{w:E,h:O}}]):a?[{filter:"scale",options:{w:Math.round(Number(a[1])/2)*2,h:"trunc(ow/a/2)*2"}}]:[{filter:"scale",options:{w:"trunc(oh*a/2)*2",h:Math.round(Number(p[1])/2)*2}}];throw new Error("Invalid size specified: "+u.size)}}return ee=function(t){t.keepPixelAspect=t.keepDisplayAspect=t.keepDisplayAspectRatio=t.keepDAR=function(){return this.videoFilters([{filter:"scale",options:{w:"if(gt(sar,1),iw*sar,iw)",h:"if(lt(sar,1),ih/sar,ih)"}},{filter:"setsar",options:"1"}])},t.withSize=t.setSize=t.size=function(c){var h=e(this._currentOutput,"size",c);return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(h),this},t.withAspect=t.withAspectRatio=t.setAspect=t.setAspectRatio=t.aspect=t.aspectRatio=function(c){var h=Number(c);if(isNaN(h)){var u=c.match(/^(\d+):(\d+)$/);if(u)h=Number(u[1])/Number(u[2]);else throw new Error("Invalid aspect ratio: "+c)}var v=e(this._currentOutput,"aspect",h);return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(v),this},t.applyAutopadding=t.applyAutoPadding=t.applyAutopad=t.applyAutoPad=t.withAutopadding=t.withAutoPadding=t.withAutopad=t.withAutoPad=t.autoPad=t.autopad=function(c,h){typeof c=="string"&&(h=c,c=!0),typeof c>"u"&&(c=!0);var u=e(this._currentOutput,"pad",c?h||"black":!1);return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(u),this}},ee}var te,Se;function Ft(){if(Se)return te;Se=1;var r=L;return te=function(e){e.addOutput=e.output=function(t,c){var h=!1;if(!t&&this._currentOutput)throw new Error("Invalid output");if(t&&typeof t!="string"){if(!("writable"in t)||!t.writable)throw new Error("Invalid output")}else if(typeof t=="string"){var u=t.match(/^([a-z]{2,}):/i);h=!u||u[0]==="file"}if(t&&!("target"in this._currentOutput))this._currentOutput.target=t,this._currentOutput.isFile=h,this._currentOutput.pipeopts=c||{};else{if(t&&typeof t!="string"){var v=this._outputs.some(function(p){return typeof p.target!="string"});if(v)throw new Error("Only one output stream is supported")}this._outputs.push(this._currentOutput={target:t,isFile:h,flags:{},pipeopts:c||{}});var a=this;["audio","audioFilters","video","videoFilters","sizeFilters","options"].forEach(function(p){a._currentOutput[p]=r.args()}),t||delete this._currentOutput.target}return this},e.seekOutput=e.seek=function(t){return this._currentOutput.options("-ss",t),this},e.withDuration=e.setDuration=e.duration=function(t){return this._currentOutput.options("-t",t),this},e.toFormat=e.withOutputFormat=e.outputFormat=e.format=function(t){return this._currentOutput.options("-f",t),this},e.map=function(t){return this._currentOutput.options("-map",t.replace(r.streamRegexp,"[$1]")),this},e.updateFlvMetadata=e.flvmeta=function(){return this._currentOutput.flags.flvmeta=!0,this}},te}var ne,Te;function xt(){if(Te)return ne;Te=1;var r=L;return ne=function(e){e.addInputOption=e.addInputOptions=e.withInputOption=e.withInputOptions=e.inputOption=e.inputOptions=function(t){if(!this._currentInput)throw new Error("No input specified");var c=!0;return arguments.length>1&&(t=[].slice.call(arguments),c=!1),Array.isArray(t)||(t=[t]),this._currentInput.options(t.reduce(function(h,u){var v=String(u).split(" ");return c&&v.length===2?h.push(v[0],v[1]):h.push(u),h},[])),this},e.addOutputOption=e.addOutputOptions=e.addOption=e.addOptions=e.withOutputOption=e.withOutputOptions=e.withOption=e.withOptions=e.outputOption=e.outputOptions=function(t){var c=!0;return arguments.length>1&&(t=[].slice.call(arguments),c=!1),Array.isArray(t)||(t=[t]),this._currentOutput.options(t.reduce(function(h,u){var v=String(u).split(" ");return c&&v.length===2?h.push(v[0],v[1]):h.push(u),h},[])),this},e.filterGraph=e.complexFilter=function(t,c){if(this._complexFilters.clear(),Array.isArray(t)||(t=[t]),this._complexFilters("-filter_complex",r.makeFilterStrings(t).join(";")),Array.isArray(c)){var h=this;c.forEach(function(u){h._complexFilters("-map",u.replace(r.streamRegexp,"[$1]"))})}else typeof c=="string"&&this._complexFilters("-map",c.replace(r.streamRegexp,"[$1]"));return this}},ne}function At(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var re,be;function Ot(){if(be)return re;be=1;var r=j;return re=function(e){e.usingPreset=e.preset=function(t){if(typeof t=="function")t(this);else try{var c=r.join(this.options.presets,t),h=At(c);if(typeof h.load=="function")h.load(this);else throw new Error("preset "+c+" has no load() function")}catch(u){throw new Error("preset "+c+" could not be loaded: "+u.message)}return this}},re}var ie={exports:{}},Re;function he(){return Re||(Re=1,function(r){(function(){var e={},t,c;t=this,t!=null&&(c=t.async),e.noConflict=function(){return t.async=c,e};function h(n){var i=!1;return function(){if(i)throw new Error("Callback was already called.");i=!0,n.apply(t,arguments)}}var u=function(n,i){if(n.forEach)return n.forEach(i);for(var s=0;s<n.length;s+=1)i(n[s],s,n)},v=function(n,i){if(n.map)return n.map(i);var s=[];return u(n,function(o,f,l){s.push(i(o,f,l))}),s},a=function(n,i,s){return n.reduce?n.reduce(i,s):(u(n,function(o,f,l){s=i(s,o,f,l)}),s)},p=function(n){if(Object.keys)return Object.keys(n);var i=[];for(var s in n)n.hasOwnProperty(s)&&i.push(s);return i};typeof process>"u"||!process.nextTick?typeof setImmediate=="function"?(e.nextTick=function(n){setImmediate(n)},e.setImmediate=e.nextTick):(e.nextTick=function(n){setTimeout(n,0)},e.setImmediate=e.nextTick):(e.nextTick=process.nextTick,typeof setImmediate<"u"?e.setImmediate=function(n){setImmediate(n)}:e.setImmediate=e.nextTick),e.each=function(n,i,s){if(s=s||function(){},!n.length)return s();var o=0;u(n,function(f){i(f,h(function(l){l?(s(l),s=function(){}):(o+=1,o>=n.length&&s(null))}))})},e.forEach=e.each,e.eachSeries=function(n,i,s){if(s=s||function(){},!n.length)return s();var o=0,f=function(){i(n[o],function(l){l?(s(l),s=function(){}):(o+=1,o>=n.length?s(null):f())})};f()},e.forEachSeries=e.eachSeries,e.eachLimit=function(n,i,s,o){var f=x(i);f.apply(null,[n,s,o])},e.forEachLimit=e.eachLimit;var x=function(n){return function(i,s,o){if(o=o||function(){},!i.length||n<=0)return o();var f=0,l=0,_=0;(function T(){if(f>=i.length)return o();for(;_<n&&l<i.length;)l+=1,_+=1,s(i[l-1],function(b){b?(o(b),o=function(){}):(f+=1,_-=1,f>=i.length?o():T())})})()}},E=function(n){return function(){var i=Array.prototype.slice.call(arguments);return n.apply(null,[e.each].concat(i))}},O=function(n,i){return function(){var s=Array.prototype.slice.call(arguments);return i.apply(null,[x(n)].concat(s))}},m=function(n){return function(){var i=Array.prototype.slice.call(arguments);return n.apply(null,[e.eachSeries].concat(i))}},I=function(n,i,s,o){var f=[];i=v(i,function(l,_){return{index:_,value:l}}),n(i,function(l,_){s(l.value,function(T,b){f[l.index]=b,_(T)})},function(l){o(l,f)})};e.map=E(I),e.mapSeries=m(I),e.mapLimit=function(n,i,s,o){return F(i)(n,s,o)};var F=function(n){return O(n,I)};e.reduce=function(n,i,s,o){e.eachSeries(n,function(f,l){s(i,f,function(_,T){i=T,l(_)})},function(f){o(f,i)})},e.inject=e.reduce,e.foldl=e.reduce,e.reduceRight=function(n,i,s,o){var f=v(n,function(l){return l}).reverse();e.reduce(f,i,s,o)},e.foldr=e.reduceRight;var A=function(n,i,s,o){var f=[];i=v(i,function(l,_){return{index:_,value:l}}),n(i,function(l,_){s(l.value,function(T){T&&f.push(l),_()})},function(l){o(v(f.sort(function(_,T){return _.index-T.index}),function(_){return _.value}))})};e.filter=E(A),e.filterSeries=m(A),e.select=e.filter,e.selectSeries=e.filterSeries;var g=function(n,i,s,o){var f=[];i=v(i,function(l,_){return{index:_,value:l}}),n(i,function(l,_){s(l.value,function(T){T||f.push(l),_()})},function(l){o(v(f.sort(function(_,T){return _.index-T.index}),function(_){return _.value}))})};e.reject=E(g),e.rejectSeries=m(g);var S=function(n,i,s,o){n(i,function(f,l){s(f,function(_){_?(o(f),o=function(){}):l()})},function(f){o()})};e.detect=E(S),e.detectSeries=m(S),e.some=function(n,i,s){e.each(n,function(o,f){i(o,function(l){l&&(s(!0),s=function(){}),f()})},function(o){s(!1)})},e.any=e.some,e.every=function(n,i,s){e.each(n,function(o,f){i(o,function(l){l||(s(!1),s=function(){}),f()})},function(o){s(!0)})},e.all=e.every,e.sortBy=function(n,i,s){e.map(n,function(o,f){i(o,function(l,_){l?f(l):f(null,{value:o,criteria:_})})},function(o,f){if(o)return s(o);var l=function(_,T){var b=_.criteria,C=T.criteria;return b<C?-1:b>C?1:0};s(null,v(f.sort(l),function(_){return _.value}))})},e.auto=function(n,i){i=i||function(){};var s=p(n);if(!s.length)return i(null);var o={},f=[],l=function(b){f.unshift(b)},_=function(b){for(var C=0;C<f.length;C+=1)if(f[C]===b){f.splice(C,1);return}},T=function(){u(f.slice(0),function(b){b()})};l(function(){p(o).length===s.length&&(i(null,o),i=function(){})}),u(s,function(b){var C=n[b]instanceof Function?[n[b]]:n[b],$=function(k){var D=Array.prototype.slice.call(arguments,1);if(D.length<=1&&(D=D[0]),k){var X={};u(p(o),function(ge){X[ge]=o[ge]}),X[b]=D,i(k,X),i=function(){}}else o[b]=D,e.setImmediate(T)},Be=C.slice(0,Math.abs(C.length-1))||[],ve=function(){return a(Be,function(k,D){return k&&o.hasOwnProperty(D)},!0)&&!o.hasOwnProperty(b)};if(ve())C[C.length-1]($,o);else{var me=function(){ve()&&(_(me),C[C.length-1]($,o))};l(me)}})},e.waterfall=function(n,i){if(i=i||function(){},n.constructor!==Array){var s=new Error("First argument to waterfall must be an array of functions");return i(s)}if(!n.length)return i();var o=function(f){return function(l){if(l)i.apply(null,arguments),i=function(){};else{var _=Array.prototype.slice.call(arguments,1),T=f.next();T?_.push(o(T)):_.push(i),e.setImmediate(function(){f.apply(null,_)})}}};o(e.iterator(n))()};var P=function(n,i,s){if(s=s||function(){},i.constructor===Array)n.map(i,function(f,l){f&&f(function(_){var T=Array.prototype.slice.call(arguments,1);T.length<=1&&(T=T[0]),l.call(null,_,T)})},s);else{var o={};n.each(p(i),function(f,l){i[f](function(_){var T=Array.prototype.slice.call(arguments,1);T.length<=1&&(T=T[0]),o[f]=T,l(_)})},function(f){s(f,o)})}};e.parallel=function(n,i){P({map:e.map,each:e.each},n,i)},e.parallelLimit=function(n,i,s){P({map:F(i),each:x(i)},n,s)},e.series=function(n,i){if(i=i||function(){},n.constructor===Array)e.mapSeries(n,function(o,f){o&&o(function(l){var _=Array.prototype.slice.call(arguments,1);_.length<=1&&(_=_[0]),f.call(null,l,_)})},i);else{var s={};e.eachSeries(p(n),function(o,f){n[o](function(l){var _=Array.prototype.slice.call(arguments,1);_.length<=1&&(_=_[0]),s[o]=_,f(l)})},function(o){i(o,s)})}},e.iterator=function(n){var i=function(s){var o=function(){return n.length&&n[s].apply(null,arguments),o.next()};return o.next=function(){return s<n.length-1?i(s+1):null},o};return i(0)},e.apply=function(n){var i=Array.prototype.slice.call(arguments,1);return function(){return n.apply(null,i.concat(Array.prototype.slice.call(arguments)))}};var y=function(n,i,s,o){var f=[];n(i,function(l,_){s(l,function(T,b){f=f.concat(b||[]),_(T)})},function(l){o(l,f)})};e.concat=E(y),e.concatSeries=m(y),e.whilst=function(n,i,s){n()?i(function(o){if(o)return s(o);e.whilst(n,i,s)}):s()},e.doWhilst=function(n,i,s){n(function(o){if(o)return s(o);i()?e.doWhilst(n,i,s):s()})},e.until=function(n,i,s){n()?s():i(function(o){if(o)return s(o);e.until(n,i,s)})},e.doUntil=function(n,i,s){n(function(o){if(o)return s(o);i()?s():e.doUntil(n,i,s)})},e.queue=function(n,i){i===void 0&&(i=1);function s(l,_,T,b){_.constructor!==Array&&(_=[_]),u(_,function(C){var $={data:C,callback:typeof b=="function"?b:null};T?l.tasks.unshift($):l.tasks.push($),l.saturated&&l.tasks.length===i&&l.saturated(),e.setImmediate(l.process)})}var o=0,f={tasks:[],concurrency:i,saturated:null,empty:null,drain:null,push:function(l,_){s(f,l,!1,_)},unshift:function(l,_){s(f,l,!0,_)},process:function(){if(o<f.concurrency&&f.tasks.length){var l=f.tasks.shift();f.empty&&f.tasks.length===0&&f.empty(),o+=1;var _=function(){o-=1,l.callback&&l.callback.apply(l,arguments),f.drain&&f.tasks.length+o===0&&f.drain(),f.process()},T=h(_);n(l.data,T)}},length:function(){return f.tasks.length},running:function(){return o}};return f},e.cargo=function(n,i){var s=!1,o=[],f={tasks:o,payload:i,saturated:null,empty:null,drain:null,push:function(l,_){l.constructor!==Array&&(l=[l]),u(l,function(T){o.push({data:T,callback:typeof _=="function"?_:null}),f.saturated&&o.length===i&&f.saturated()}),e.setImmediate(f.process)},process:function l(){if(!s){if(o.length===0){f.drain&&f.drain();return}var _=typeof i=="number"?o.splice(0,i):o.splice(0),T=v(_,function(b){return b.data});f.empty&&f.empty(),s=!0,n(T,function(){s=!1;var b=arguments;u(_,function(C){C.callback&&C.callback.apply(null,b)}),l()})}},length:function(){return o.length},running:function(){return s}};return f};var w=function(n){return function(i){var s=Array.prototype.slice.call(arguments,1);i.apply(null,s.concat([function(o){var f=Array.prototype.slice.call(arguments,1);typeof console<"u"&&(o?console.error&&console.error(o):console[n]&&u(f,function(l){console[n](l)}))}]))}};e.log=w("log"),e.dir=w("dir"),e.memoize=function(n,i){var s={},o={};i=i||function(l){return l};var f=function(){var l=Array.prototype.slice.call(arguments),_=l.pop(),T=i.apply(null,l);T in s?_.apply(null,s[T]):T in o?o[T].push(_):(o[T]=[_],n.apply(null,l.concat([function(){s[T]=arguments;var b=o[T];delete o[T];for(var C=0,$=b.length;C<$;C++)b[C].apply(null,arguments)}])))};return f.memo=s,f.unmemoized=n,f},e.unmemoize=function(n){return function(){return(n.unmemoized||n).apply(null,arguments)}},e.times=function(n,i,s){for(var o=[],f=0;f<n;f++)o.push(f);return e.map(o,i,s)},e.timesSeries=function(n,i,s){for(var o=[],f=0;f<n;f++)o.push(f);return e.mapSeries(o,i,s)},e.compose=function(){var n=Array.prototype.reverse.call(arguments);return function(){var i=this,s=Array.prototype.slice.call(arguments),o=s.pop();e.reduce(n,s,function(f,l,_){l.apply(i,f.concat([function(){var T=arguments[0],b=Array.prototype.slice.call(arguments,1);_(T,b)}]))},function(f,l){o.apply(i,[f].concat(l))})}};var d=function(n,i){var s=function(){var f=this,l=Array.prototype.slice.call(arguments),_=l.pop();return n(i,function(T,b){T.apply(f,l.concat([b]))},_)};if(arguments.length>2){var o=Array.prototype.slice.call(arguments,2);return s.apply(this,o)}else return s};e.applyEach=E(d),e.applyEachSeries=m(d),e.forever=function(n,i){function s(o){if(o){if(i)return i(o);throw o}n(s)}s()},r.exports?r.exports=e:t.async=e})()}(ie)),ie.exports}var ue,Ce;function Pt(){if(Ce)return ue;Ce=1;var r=le.spawn,e=he(),t=L;function c(h){h._inputs[0].isStream||h.ffprobe(0,function(v,a){h._ffprobeData=a})}return ue=function(h){h._spawnFfmpeg=function(u,v,a,p){typeof v=="function"&&(p=a,a=v,v={}),typeof p>"u"&&(p=a,a=function(){});var x="stdoutLines"in v?v.stdoutLines:this.options.stdoutLines;this._getFfmpegPath(function(E,O){if(E)return p(E);if(!O||O.length===0)return p(new Error("Cannot find ffmpeg"));v.niceness&&v.niceness!==0&&!t.isWindows&&(u.unshift("-n",v.niceness,O),O="nice");var m=t.linesRing(x),I=!1,F=t.linesRing(x),A=!1,g=r(O,u,v);g.stderr&&g.stderr.setEncoding("utf8"),g.on("error",function(w){p(w)});var S=null;function P(w){w&&(S=w),y&&(I||!v.captureStdout)&&A&&p(S,m,F)}var y=!1;g.on("exit",function(w,d){y=!0,d?P(new Error("ffmpeg was killed with signal "+d)):w?P(new Error("ffmpeg exited with code "+w)):P()}),v.captureStdout&&(g.stdout.on("data",function(w){m.append(w)}),g.stdout.on("close",function(){m.close(),I=!0,P()})),g.stderr.on("data",function(w){F.append(w)}),g.stderr.on("close",function(){F.close(),A=!0,P()}),a(g,m,F)})},h._getArguments=function(){var u=this._complexFilters.get(),v=this._outputs.some(function(a){return a.isFile});return[].concat(this._inputs.reduce(function(a,p){var x=typeof p.source=="string"?p.source:"pipe:0";return a.concat(p.options.get(),["-i",x])},[]),this._global.get(),v?["-y"]:[],u,this._outputs.reduce(function(a,p){var x=t.makeFilterStrings(p.sizeFilters.get()),E=p.audioFilters.get(),O=p.videoFilters.get().concat(x),m;return p.target?typeof p.target=="string"?m=[p.target]:m=["pipe:1"]:m=[],a.concat(p.audio.get(),E.length?["-filter:a",E.join(",")]:[],p.video.get(),O.length?["-filter:v",O.join(",")]:[],p.options.get(),m)},[]))},h._prepare=function(u,v){var a=this;e.waterfall([function(p){a._checkCapabilities(p)},function(p){if(!v)return p();a.ffprobe(0,function(x,E){x||(a._ffprobeData=E),p()})},function(p){var x=a._outputs.some(function(E){return E.flags.flvmeta&&!E.isFile&&(a.logger.warn("Updating flv metadata is only supported for files"),E.flags.flvmeta=!1),E.flags.flvmeta});x?a._getFlvtoolPath(function(E){p(E)}):p()},function(p){var x;try{x=a._getArguments()}catch(E){return p(E)}p(null,x)},function(p,x){a.availableEncoders(function(E,O){for(var m=0;m<p.length;m++)(p[m]==="-acodec"||p[m]==="-vcodec")&&(m++,p[m]in O&&O[p[m]].experimental&&(p.splice(m+1,0,"-strict","experimental"),m+=2));x(null,p)})}],u),v||(this.listeners("progress").length>0?c(this):this.once("newListener",function(p){p==="progress"&&c(this)}))},h.exec=h.execute=h.run=function(){var u=this,v=this._outputs.some(function(O){return"target"in O});if(!v)throw new Error("No output specified");var a=this._outputs.filter(function(O){return typeof O.target!="string"})[0],p=this._inputs.filter(function(O){return typeof O.source!="string"})[0],x=!1;function E(O,m,I){x||(x=!0,O?u.emit("error",O,m,I):u.emit("end",m,I))}return u._prepare(function(O,m){if(O)return E(O);u._spawnFfmpeg(m,{captureStdout:!a,niceness:u.options.niceness,cwd:u.options.cwd,windowsHide:!0},function(F,A,g){if(u.ffmpegProc=F,u.emit("start","ffmpeg "+m.join(" ")),p&&(p.source.on("error",function(y){var w=new Error("Input stream error: "+y.message);w.inputStreamError=y,E(w),F.kill()}),p.source.resume(),p.source.pipe(F.stdin),F.stdin.on("error",function(){})),u.options.timeout&&(u.processTimer=setTimeout(function(){var y="process ran into a timeout ("+u.options.timeout+"s)";E(new Error(y),A.get(),g.get()),F.kill()},u.options.timeout*1e3)),a&&(F.stdout.pipe(a.target,a.pipeopts),a.target.on("close",function(){u.logger.debug("Output stream closed, scheduling kill for ffmpeg process"),setTimeout(function(){E(new Error("Output stream closed")),F.kill()},20)}),a.target.on("error",function(y){u.logger.debug("Output stream error, killing ffmpeg process");var w=new Error("Output stream error: "+y.message);w.outputStreamError=y,E(w,A.get(),g.get()),F.kill("SIGKILL")})),g){if(u.listeners("stderr").length&&g.callback(function(y){u.emit("stderr",y)}),u.listeners("codecData").length){var S=!1,P={};g.callback(function(y){S||(S=t.extractCodecData(u,y,P))})}u.listeners("progress").length&&g.callback(function(y){t.extractProgress(u,y)})}},function(F,A,g){if(clearTimeout(u.processTimer),delete u.ffmpegProc,F)F.message.match(/ffmpeg exited with code/)&&(F.message+=": "+t.extractError(g.get())),E(F,A.get(),g.get());else{var S=u._outputs.filter(function(P){return P.flags.flvmeta});S.length?u._getFlvtoolPath(function(P,y){if(P)return E(P);e.each(S,function(w,d){r(y,["-U",w.target],{windowsHide:!0}).on("error",function(n){d(new Error("Error running "+y+" on "+w.target+": "+n.message))}).on("exit",function(n,i){n!==0||i?d(new Error(y+" "+(i?"received signal "+i:"exited with code "+n))+" when running on "+w.target):d()})},function(w){w?E(w):E(null,A.get(),g.get())})}):E(null,A.get(),g.get())}})}),this},h.renice=function(u){if(!t.isWindows&&(u=u||0,(u<-20||u>20)&&this.logger.warn("Invalid niceness value: "+u+", must be between -20 and 20"),u=Math.min(20,Math.max(-20,u)),this.options.niceness=u,this.ffmpegProc)){var v=this.logger,a=this.ffmpegProc.pid,p=r("renice",[u,"-p",a],{windowsHide:!0});p.on("error",function(x){v.warn("could not renice process "+a+": "+x.message)}),p.on("exit",function(x,E){E?v.warn("could not renice process "+a+": renice was killed by signal "+E):x?v.warn("could not renice process "+a+": renice exited with "+x):v.info("successfully reniced process "+a+" to "+u+" niceness")})}return this},h.kill=function(u){return this.ffmpegProc?this.ffmpegProc.kill(u||"SIGKILL"):this.logger.warn("No running ffmpeg process, cannot send signal"),this}},ue}var se,ze;function It(){if(ze)return se;ze=1;var r=G,e=j,t=he(),c=L,h=/^\s*([D ])([E ])([VAS])([S ])([D ])([T ]) ([^ ]+) +(.*)$/,u=/^\s*([D\.])([E\.])([VAS])([I\.])([L\.])([S\.]) ([^ ]+) +(.*)$/,v=/\(encoders:([^\)]+)\)/,a=/\(decoders:([^\)]+)\)/,p=/^\s*([VAS\.])([F\.])([S\.])([X\.])([B\.])([D\.]) ([^ ]+) +(.*)$/,x=/^\s*([D ])([E ])\s+([^ ]+)\s+(.*)$/,E=/\r\n|\r|\n/,O=/^(?: [T\.][S\.][C\.] )?([^ ]+) +(AA?|VV?|\|)->(AA?|VV?|\|) +(.*)$/,m={};return se=function(I){I.setFfmpegPath=function(F){return m.ffmpegPath=F,this},I.setFfprobePath=function(F){return m.ffprobePath=F,this},I.setFlvtoolPath=function(F){return m.flvtoolPath=F,this},I._forgetPaths=function(){delete m.ffmpegPath,delete m.ffprobePath,delete m.flvtoolPath},I._getFfmpegPath=function(F){if("ffmpegPath"in m)return F(null,m.ffmpegPath);t.waterfall([function(A){process.env.FFMPEG_PATH?r.exists(process.env.FFMPEG_PATH,function(g){g?A(null,process.env.FFMPEG_PATH):A(null,"")}):A(null,"")},function(A,g){if(A.length)return g(null,A);c.which("ffmpeg",function(S,P){g(S,P)})}],function(A,g){A?F(A):F(null,m.ffmpegPath=g||"")})},I._getFfprobePath=function(F){var A=this;if("ffprobePath"in m)return F(null,m.ffprobePath);t.waterfall([function(g){process.env.FFPROBE_PATH?r.exists(process.env.FFPROBE_PATH,function(S){g(null,S?process.env.FFPROBE_PATH:"")}):g(null,"")},function(g,S){if(g.length)return S(null,g);c.which("ffprobe",function(P,y){S(P,y)})},function(g,S){if(g.length)return S(null,g);A._getFfmpegPath(function(P,y){if(P)S(P);else if(y.length){var w=c.isWindows?"ffprobe.exe":"ffprobe",d=e.join(e.dirname(y),w);r.exists(d,function(n){S(null,n?d:"")})}else S(null,"")})}],function(g,S){g?F(g):F(null,m.ffprobePath=S||"")})},I._getFlvtoolPath=function(F){if("flvtoolPath"in m)return F(null,m.flvtoolPath);t.waterfall([function(A){process.env.FLVMETA_PATH?r.exists(process.env.FLVMETA_PATH,function(g){A(null,g?process.env.FLVMETA_PATH:"")}):A(null,"")},function(A,g){if(A.length)return g(null,A);process.env.FLVTOOL2_PATH?r.exists(process.env.FLVTOOL2_PATH,function(S){g(null,S?process.env.FLVTOOL2_PATH:"")}):g(null,"")},function(A,g){if(A.length)return g(null,A);c.which("flvmeta",function(S,P){g(S,P)})},function(A,g){if(A.length)return g(null,A);c.which("flvtool2",function(S,P){g(S,P)})}],function(A,g){A?F(A):F(null,m.flvtoolPath=g||"")})},I.availableFilters=I.getAvailableFilters=function(F){if("filters"in m)return F(null,m.filters);this._spawnFfmpeg(["-filters"],{captureStdout:!0,stdoutLines:0},function(A,g){if(A)return F(A);var S=g.get(),P=S.split(`
`),y={},w={A:"audio",V:"video","|":"none"};P.forEach(function(d){var n=d.match(O);n&&(y[n[1]]={description:n[4],input:w[n[2].charAt(0)],multipleInputs:n[2].length>1,output:w[n[3].charAt(0)],multipleOutputs:n[3].length>1})}),F(null,m.filters=y)})},I.availableCodecs=I.getAvailableCodecs=function(F){if("codecs"in m)return F(null,m.codecs);this._spawnFfmpeg(["-codecs"],{captureStdout:!0,stdoutLines:0},function(A,g){if(A)return F(A);var S=g.get(),P=S.split(E),y={};P.forEach(function(w){var d=w.match(h);if(d&&d[7]!=="="&&(y[d[7]]={type:{V:"video",A:"audio",S:"subtitle"}[d[3]],description:d[8],canDecode:d[1]==="D",canEncode:d[2]==="E",drawHorizBand:d[4]==="S",directRendering:d[5]==="D",weirdFrameTruncation:d[6]==="T"}),d=w.match(u),d&&d[7]!=="="){var n=y[d[7]]={type:{V:"video",A:"audio",S:"subtitle"}[d[3]],description:d[8],canDecode:d[1]==="D",canEncode:d[2]==="E",intraFrameOnly:d[4]==="I",isLossy:d[5]==="L",isLossless:d[6]==="S"},i=n.description.match(v);i=i?i[1].trim().split(" "):[];var s=n.description.match(a);if(s=s?s[1].trim().split(" "):[],i.length||s.length){var o={};c.copy(n,o),delete o.canEncode,delete o.canDecode,i.forEach(function(f){y[f]={},c.copy(o,y[f]),y[f].canEncode=!0}),s.forEach(function(f){f in y||(y[f]={},c.copy(o,y[f])),y[f].canDecode=!0})}}}),F(null,m.codecs=y)})},I.availableEncoders=I.getAvailableEncoders=function(F){if("encoders"in m)return F(null,m.encoders);this._spawnFfmpeg(["-encoders"],{captureStdout:!0,stdoutLines:0},function(A,g){if(A)return F(A);var S=g.get(),P=S.split(E),y={};P.forEach(function(w){var d=w.match(p);d&&d[7]!=="="&&(y[d[7]]={type:{V:"video",A:"audio",S:"subtitle"}[d[1]],description:d[8],frameMT:d[2]==="F",sliceMT:d[3]==="S",experimental:d[4]==="X",drawHorizBand:d[5]==="B",directRendering:d[6]==="D"})}),F(null,m.encoders=y)})},I.availableFormats=I.getAvailableFormats=function(F){if("formats"in m)return F(null,m.formats);this._spawnFfmpeg(["-formats"],{captureStdout:!0,stdoutLines:0},function(A,g){if(A)return F(A);var S=g.get(),P=S.split(E),y={};P.forEach(function(w){var d=w.match(x);d&&d[3].split(",").forEach(function(n){n in y||(y[n]={description:d[4],canDemux:!1,canMux:!1}),d[1]==="D"&&(y[n].canDemux=!0),d[2]==="E"&&(y[n].canMux=!0)})}),F(null,m.formats=y)})},I._checkCapabilities=function(F){var A=this;t.waterfall([function(g){A.availableFormats(g)},function(g,S){var P;if(P=A._outputs.reduce(function(y,w){var d=w.options.find("-f",1);return d&&(!(d[0]in g)||!g[d[0]].canMux)&&y.push(d),y},[]),P.length===1)return S(new Error("Output format "+P[0]+" is not available"));if(P.length>1)return S(new Error("Output formats "+P.join(", ")+" are not available"));if(P=A._inputs.reduce(function(y,w){var d=w.options.find("-f",1);return d&&(!(d[0]in g)||!g[d[0]].canDemux)&&y.push(d[0]),y},[]),P.length===1)return S(new Error("Input format "+P[0]+" is not available"));if(P.length>1)return S(new Error("Input formats "+P.join(", ")+" are not available"));S()},function(g){A.availableEncoders(g)},function(g,S){var P;if(P=A._outputs.reduce(function(y,w){var d=w.audio.find("-acodec",1);return d&&d[0]!=="copy"&&(!(d[0]in g)||g[d[0]].type!=="audio")&&y.push(d[0]),y},[]),P.length===1)return S(new Error("Audio codec "+P[0]+" is not available"));if(P.length>1)return S(new Error("Audio codecs "+P.join(", ")+" are not available"));if(P=A._outputs.reduce(function(y,w){var d=w.video.find("-vcodec",1);return d&&d[0]!=="copy"&&(!(d[0]in g)||g[d[0]].type!=="video")&&y.push(d[0]),y},[]),P.length===1)return S(new Error("Video codec "+P[0]+" is not available"));if(P.length>1)return S(new Error("Video codecs "+P.join(", ")+" are not available"));S()}],F)}},se}var ae,Ne;function St(){if(Ne)return ae;Ne=1;var r=le.spawn;function e(h){return h.match(/^TAG:/)}function t(h){return h.match(/^DISPOSITION:/)}function c(h){var u=h.split(/\r\n|\r|\n/);u=u.filter(function(O){return O.length>0});var v={streams:[],format:{},chapters:[]};function a(O){for(var m={},I=u.shift();typeof I<"u";){if(I.toLowerCase()=="[/"+O+"]")return m;if(I.match(/^\[/)){I=u.shift();continue}var F=I.match(/^([^=]+)=(.*)$/);F&&(!F[1].match(/^TAG:/)&&F[2].match(/^[0-9]+(\.[0-9]+)?$/)?m[F[1]]=Number(F[2]):m[F[1]]=F[2]),I=u.shift()}return m}for(var p=u.shift();typeof p<"u";){if(p.match(/^\[stream/i)){var x=a("stream");v.streams.push(x)}else if(p.match(/^\[chapter/i)){var E=a("chapter");v.chapters.push(E)}else p.toLowerCase()==="[format]"&&(v.format=a("format"));p=u.shift()}return v}return ae=function(h){h.ffprobe=function(){var u,v=null,a=[],p,p=arguments[arguments.length-1],x=!1;function E(O,m){x||(x=!0,p(O,m))}switch(arguments.length){case 3:v=arguments[0],a=arguments[1];break;case 2:typeof arguments[0]=="number"?v=arguments[0]:Array.isArray(arguments[0])&&(a=arguments[0]);break}if(v===null){if(!this._currentInput)return E(new Error("No input specified"));u=this._currentInput}else if(u=this._inputs[v],!u)return E(new Error("Invalid input index"));this._getFfprobePath(function(O,m){if(O)return E(O);if(!m)return E(new Error("Cannot find ffprobe"));var I="",F=!1,A="",g=!1,S=u.isStream?"pipe:0":u.source,P=r(m,["-show_streams","-show_format"].concat(a,S),{windowsHide:!0});u.isStream&&(P.stdin.on("error",function(n){["ECONNRESET","EPIPE","EOF"].indexOf(n.code)>=0||E(n)}),P.stdin.on("close",function(){u.source.pause(),u.source.unpipe(P.stdin)}),u.source.pipe(P.stdin)),P.on("error",p);var y=null;function w(n){if(n&&(y=n),d&&F&&g){if(y)return A&&(y.message+=`
`+A),E(y);var i=c(I);[i.format].concat(i.streams).forEach(function(s){if(s){var o=Object.keys(s).filter(e);o.length&&(s.tags=s.tags||{},o.forEach(function(l){s.tags[l.substr(4)]=s[l],delete s[l]}));var f=Object.keys(s).filter(t);f.length&&(s.disposition=s.disposition||{},f.forEach(function(l){s.disposition[l.substr(12)]=s[l],delete s[l]}))}}),E(null,i)}}var d=!1;P.on("exit",function(n,i){d=!0,n?w(new Error("ffprobe exited with code "+n)):i?w(new Error("ffprobe was killed with signal "+i)):w()}),P.stdout.on("data",function(n){I+=n}),P.stdout.on("close",function(){F=!0,w()}),P.stderr.on("data",function(n){A+=n}),P.stderr.on("close",function(){g=!0,w()})})}},ae}var oe,qe;function Tt(){if(qe)return oe;qe=1;var r=G,e=j,t=it.PassThrough,c=he(),h=L;return oe=function(v){v.saveToFile=v.save=function(a){return this.output(a).run(),this},v.writeToStream=v.pipe=v.stream=function(a,p){if(a&&!("writable"in a)&&(p=a,a=void 0),!a){if(process.version.match(/v0\.8\./))throw new Error("PassThrough stream is not supported on node v0.8");a=new t}return this.output(a,p).run(),a},v.takeScreenshots=v.thumbnail=v.thumbnails=v.screenshot=v.screenshots=function(a,p){var x=this,E=this._currentInput.source;if(a=a||{count:1},typeof a=="number"&&(a={count:a}),"folder"in a||(a.folder=p||"."),"timestamps"in a&&(a.timemarks=a.timestamps),!("timemarks"in a)){if(!a.count)throw new Error("Cannot take screenshots: neither a count nor a timemark list are specified");var O=100/(1+a.count);a.timemarks=[];for(var m=0;m<a.count;m++)a.timemarks.push(O*(m+1)+"%")}if("size"in a){var I=a.size.match(/^(\d+)x(\d+)$/),F=a.size.match(/^(\d+)x\?$/),A=a.size.match(/^\?x(\d+)$/),g=a.size.match(/^(\d+)%$/);if(!I&&!F&&!A&&!g)throw new Error("Invalid size parameter: "+a.size)}var S;function P(y){S?y(null,S):x.ffprobe(function(w,d){S=d,y(w,d)})}return c.waterfall([function(w){if(a.timemarks.some(function(d){return(""+d).match(/^[\d.]+%$/)})){if(typeof E!="string")return w(new Error("Cannot compute screenshot timemarks with an input stream, please specify fixed timemarks"));P(function(d,n){if(d)w(d);else{var i=n.streams.reduce(function(o,f){return f.codec_type==="video"&&f.width*f.height>o.width*o.height?f:o},{width:0,height:0});if(i.width===0)return w(new Error("No video stream in input, cannot take screenshots"));var s=Number(i.duration);if(isNaN(s)&&(s=Number(n.format.duration)),isNaN(s))return w(new Error("Could not get input duration, please specify fixed timemarks"));a.timemarks=a.timemarks.map(function(o){return(""+o).match(/^([\d.]+)%$/)?s*parseFloat(o)/100:o}),w()}})}else w()},function(w){a.timemarks=a.timemarks.map(function(d){return h.timemarkToSeconds(d)}).sort(function(d,n){return d-n}),w()},function(w){var d=a.filename||"tn.png";if(d.indexOf(".")===-1&&(d+=".png"),a.timemarks.length>1&&!d.match(/%(s|0*i)/)){var n=e.extname(d);d=e.join(e.dirname(d),e.basename(d,n)+"_%i"+n)}w(null,d)},function(w,d){if(w.match(/%[bf]/)){if(typeof E!="string")return d(new Error("Cannot replace %f or %b when using an input stream"));w=w.replace(/%f/g,e.basename(E)).replace(/%b/g,e.basename(E,e.extname(E)))}d(null,w)},function(w,d){if(w.match(/%[whr]/)){if(I)return d(null,w,I[1],I[2]);P(function(n,i){if(n)return d(new Error("Could not determine video resolution to replace %w, %h or %r"));var s=i.streams.reduce(function(l,_){return _.codec_type==="video"&&_.width*_.height>l.width*l.height?_:l},{width:0,height:0});if(s.width===0)return d(new Error("No video stream in input, cannot replace %w, %h or %r"));var o=s.width,f=s.height;F?(f=f*Number(F[1])/o,o=Number(F[1])):A?(o=o*Number(A[1])/f,f=Number(A[1])):g&&(o=o*Number(g[1])/100,f=f*Number(g[1])/100),d(null,w,Math.round(o/2)*2,Math.round(f/2)*2)})}else d(null,w,-1,-1)},function(w,d,n,i){w=w.replace(/%r/g,"%wx%h").replace(/%w/g,d).replace(/%h/g,n),i(null,w)},function(w,d){var n=a.timemarks.map(function(i,s){return w.replace(/%s/g,h.timemarkToSeconds(i)).replace(/%(0*)i/g,function(o,f){var l=""+(s+1);return f.substr(0,Math.max(0,f.length+1-l.length))+l})});x.emit("filenames",n),d(null,n)},function(w,d){r.exists(a.folder,function(n){n?d(null,w):r.mkdir(a.folder,function(i){i?d(i):d(null,w)})})}],function(w,d){if(w)return x.emit("error",w);var n=a.timemarks.length,i,s=[i={filter:"split",options:n,outputs:[]}];if("size"in a){x.size(a.size);var o=x._currentOutput.sizeFilters.get().map(function(T,b){return b>0&&(T.inputs="size"+(b-1)),T.outputs="size"+b,T});i.inputs="size"+(o.length-1),s=o.concat(s),x._currentOutput.sizeFilters.clear()}for(var f=0,l=0;l<n;l++){var _="screen"+l;i.outputs.push(_),l===0&&(f=a.timemarks[l],x.seekInput(f)),x.output(e.join(a.folder,d[l])).frames(1).map(_),l>0&&x.seek(a.timemarks[l]-f)}x.complexFilter(s),x.run()}),this},v.mergeToFile=v.concatenate=v.concat=function(a,p){var x=this._inputs.filter(function(O){return!O.isStream})[0],E=this;return this.ffprobe(this._inputs.indexOf(x),function(O,m){if(O)return E.emit("error",O);var I=m.streams.some(function(A){return A.codec_type==="audio"}),F=m.streams.some(function(A){return A.codec_type==="video"});E.output(a,p).complexFilter({filter:"concat",options:{n:E._inputs.length,v:F?1:0,a:I?1:0}}).run()}),this}},oe}var bt=j,Rt=nt,ke=rt.EventEmitter,ce=L;function R(r,e){if(!(this instanceof R))return new R(r,e);ke.call(this),typeof r=="object"&&!("readable"in r)?e=r:(e=e||{},e.source=r),this._inputs=[],e.source&&this.input(e.source),this._outputs=[],this.output();var t=this;["_global","_complexFilters"].forEach(function(c){t[c]=ce.args()}),e.stdoutLines="stdoutLines"in e?e.stdoutLines:100,e.presets=e.presets||e.preset||bt.join(__dirname,"presets"),e.niceness=e.niceness||e.priority||0,this.options=e,this.logger=e.logger||{debug:function(){},info:function(){},warn:function(){},error:function(){}}}Rt.inherits(R,ke);var Ct=R;R.prototype.clone=function(){var r=new R,e=this;return r.options=this.options,r.logger=this.logger,r._inputs=this._inputs.map(function(t){return{source:t.source,options:t.options.clone()}}),"target"in this._outputs[0]?(r._outputs=[],r.output()):(r._outputs=[r._currentOutput={flags:{}}],["audio","audioFilters","video","videoFilters","sizeFilters","options"].forEach(function(t){r._currentOutput[t]=e._currentOutput[t].clone()}),this._currentOutput.sizeData&&(r._currentOutput.sizeData={},ce.copy(this._currentOutput.sizeData,r._currentOutput.sizeData)),ce.copy(this._currentOutput.flags,r._currentOutput.flags)),["_global","_complexFilters"].forEach(function(t){r[t]=e[t].clone()}),r};wt()(R.prototype);yt()(R.prototype);_t()(R.prototype);Et()(R.prototype);Ft()(R.prototype);xt()(R.prototype);Ot()(R.prototype);Pt()(R.prototype);It()(R.prototype);R.setFfmpegPath=function(r){new R().setFfmpegPath(r)};R.setFfprobePath=function(r){new R().setFfprobePath(r)};R.setFlvtoolPath=function(r){new R().setFlvtoolPath(r)};R.availableFilters=R.getAvailableFilters=function(r){new R().availableFilters(r)};R.availableCodecs=R.getAvailableCodecs=function(r){new R().availableCodecs(r)};R.availableFormats=R.getAvailableFormats=function(r){new R().availableFormats(r)};R.availableEncoders=R.getAvailableEncoders=function(r){new R().availableEncoders(r)};St()(R.prototype);R.ffprobe=function(r){var e=new R(r);e.ffprobe.apply(e,Array.prototype.slice.call(arguments,1))};Tt()(R.prototype);var zt=Ct;const He=at(zt);et.createRequire(typeof document>"u"?require("url").pathToFileURL(__filename).href:M&&M.tagName.toUpperCase()==="SCRIPT"&&M.src||new URL("main.js",document.baseURI).href);const Ue=N.dirname(tt.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:M&&M.tagName.toUpperCase()==="SCRIPT"&&M.src||new URL("main.js",document.baseURI).href));process.env.APP_ROOT=N.join(Ue,"..");const W=process.env.VITE_DEV_SERVER_URL,Nt=N.join(process.env.APP_ROOT,"dist-electron"),de=N.join(process.env.APP_ROOT,"dist");process.env.VITE_PUBLIC=W?N.join(process.env.APP_ROOT,"public"):de;let z;function We(){z=new q.BrowserWindow({icon:N.join(process.env.VITE_PUBLIC,"convertHero.ico"),width:1200,height:700,minHeight:700,minWidth:1024,frame:!0,webPreferences:{preload:N.join(Ue,"preload.js"),contextIsolation:!0,nodeIntegration:!0,sandbox:!1,webSecurity:!1}}),z.webContents.on("did-finish-load",()=>{z==null||z.webContents.send("main-process-message",new Date().toLocaleString())}),W?z.loadURL(W):z.loadFile(N.join(de,"index.html"))}q.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(q.app.quit(),z=null)});q.app.on("activate",()=>{q.BrowserWindow.getAllWindows().length===0&&We()});q.ipcMain.on("window-control",(r,e)=>{const t=q.BrowserWindow.getFocusedWindow();if(t)switch(e){case"minimize":t.minimize();break;case"maximize":t.isMaximized()?t.unmaximize():t.maximize();break;case"close":t.close();break}});const qt={ultrafast:"ultrafast",fast:"fast",medium:"medium",slow:"slow",veryslow:"veryslow"};q.ipcMain.handle("convert-videos",async(r,e)=>{const{files:t,format:c,quality:h,speed:u,openFolder:v,outputFolder:a,cpuCores:p,useHardwareAcceleration:x}=e;if(!Array.isArray(t)||t.length===0)throw new Error("Nenhum arquivo recebido.");const E={"1080p":"1920x1080","720p":"1280x720","480p":"854x480"},O=[];for(const m of t){const I=N.parse(m),F=a||I.dir,A=N.join(F,`${I.name}_Converted.${c}`),g=[];if(x&&c==="mp4"?g.push("-c:v h264_amf"):(g.push(`-preset ${qt[u]||"medium"}`),g.push(`-threads ${p||B.cpus().length}`)),h!=="original"){const S=E[h];S&&g.push(`-vf scale=${S}`)}z==null||z.webContents.send("conversion-started",{file:m}),await new Promise((S,P)=>{He(m).outputOptions(g).on("start",y=>{console.log("FFmpeg command:",y)}).on("progress",y=>{const w=Math.floor(y.percent||0);z==null||z.webContents.send("conversion-progress",{file:m,percent:w})}).on("end",()=>{console.log(`✅ Convertido: ${A}`),z==null||z.webContents.send("conversion-completed",{file:m}),O.push(A),S()}).on("error",y=>{console.error("❌ Erro na conversão:",y.message),P(y)}).toFormat(c).save(A)})}if(v&&O.length>0){const{shell:m}=await import("electron"),I=N.dirname(O[0]);m.openPath(I)}return O});q.ipcMain.handle("select-output-folder",async()=>{const r=await q.dialog.showOpenDialog({properties:["openDirectory"]});return r.canceled||r.filePaths.length===0?null:r.filePaths[0]});q.ipcMain.handle("getCpuCores",()=>B.cpus().length);q.ipcMain.handle("generate-thumbnail",async(r,e)=>{const t=N.join(B.tmpdir(),`${N.parse(e).name}_thumb.jpg`);return new Promise((c,h)=>{He(e).on("end",()=>{console.log("📸 Thumbnail gerada:",t),c(t)}).on("error",u=>{console.error("❌ Erro ao gerar thumbnail:",u.message),h(u)}).screenshots({timestamps:["00:00:01"],filename:N.basename(t),folder:N.dirname(t)})})});q.ipcMain.handle("delete-file",async(r,e)=>{try{return await ut.promises.unlink(e),console.log("🗑️ Thumbnail deletada:",e),!0}catch(t){return console.error("❌ Erro ao deletar thumbnail:",t),!1}});q.app.whenReady().then(We);exports.MAIN_DIST=Nt;exports.RENDERER_DIST=de;exports.VITE_DEV_SERVER_URL=W;
